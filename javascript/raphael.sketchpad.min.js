(function(h){h.sketchpad=function(b,c){return new r(b,c)};h.sketchpad.VERSION="0.5.1";var r=function(b,c){function e(){w.clear();for(var a=0,m=j.length;a<m;a++){var k=j[a];w[k.type]().attr(k).click(p)}}function p(){if(t.editing=="erase"){var a=this.attr();a.type=this.type;u.add({type:"erase",stroke:a});for(var m=0,k=j.length;m<k;m++)equiv(j[m],a)&&j.splice(m,1);x();this.remove()}}function n(a){$("*").css("-webkit-user-select","none");$("*").css("-moz-user-select","none");B.start(a,f)}function i(a){B.move(a,
f)}function s(a){$("*").css("-webkit-user-select","text");$("*").css("-moz-user-select","text");a=B.finish(a,f);if(a!=null){a.click(p);var m=a.attr();m.type=a.type;j.push(m);u.add({type:"stroke",stroke:m});x()}}function q(a){a=a.originalEvent;a.preventDefault();a.touches.length==1&&n(a.touches[0])}function o(a){a=a.originalEvent;a.preventDefault();a.touches.length==1&&i(a.touches[0])}function d(a){a=a.originalEvent;a.preventDefault();s(a)}var f=this,t={width:100,height:100,strokes:[],editing:true};
jQuery.extend(t,c);var w;if(b.raphael&&b.raphael.constructor==h.constructor)w=b;else if(typeof b=="string")w=h(b,t.width,t.height);else throw"first argument must be a Raphael object, an element ID, an array with 3 elements";var E=w.canvas,l=$(E).parent(),B=new g;f.paper=function(){return w};f.canvas=function(){return E};f.container=function(){return l};f.pen=function(a){if(a===undefined)return B;B=a;return f};f.json=function(a){if(a===undefined){a=0;for(var m=j.length;a<m;a++){var k=j[a];if(typeof k.path==
"object"){var z=k;k=k.path;for(var A="",v=0,C=k.length;v<C;v++){var D=k[v];A+=D[0]+D[1]+","+D[2]}z.path=A}}return JSON.stringify(j)}return f.strokes(JSON.parse(a))};f.strokes=function(a){if(a===undefined)return j;if(jQuery.isArray(a)){j=a;a=0;for(var m=j.length;a<m;a++){var k=j[a];if(typeof k.path=="string"){var z=k,A=[];k=k.path.split("L");if(k.length>0){var v=k[0].replace("M","");v=v.split(",");A.push(["M",parseInt(v[0]),parseInt(v[1])]);for(var C=1,D=k.length;C<D;C++){v=k[C];v=v.split(",");A.push(["L",
parseInt(v[0]),parseInt(v[1])])}}z.path=A}}u.add({type:"batch",strokes:jQuery.merge([],j)});e();x()}return f};f.freeze_history=function(){u.freeze()};f.undoable=function(){return u.undoable()};f.undo=function(){if(u.undoable()){u.undo();j=u.current_strokes();e();x()}return f};f.redoable=function(){return u.redoable()};f.redo=function(){if(u.redoable()){u.redo();j=u.current_strokes();e();x()}return f};f.clear=function(){u.add({type:"clear"});j=[];e();x();return f};f.animate=function(a){if(a===undefined)a=
500;w.clear();if(j.length>0){var m=0,k=function(){var z=j[m];w[z.type]().attr(z).click(p);m++;m<j.length&&setTimeout(k,a)};k()}return f};f.editing=function(a){if(a===undefined)return t.editing;t.editing=a;if(t.editing)if(t.editing=="erase"){$(l).css("cursor","crosshair");$(l).unbind("mousedown",n);$(l).unbind("mousemove",i);$(l).unbind("mouseup",s);$(document).unbind("mouseup",s);a=navigator.userAgent;if(a.indexOf("iPhone")>0||a.indexOf("iPod")>0){$(l).unbind("touchstart",q);$(l).unbind("touchmove",
o);$(l).unbind("touchend",d)}}else{$(l).css("cursor","crosshair");$(l).mousedown(n);$(l).mousemove(i);$(l).mouseup(s);$(document).mouseup(s);a=navigator.userAgent;if(a.indexOf("iPhone")>0||a.indexOf("iPod")>0){$(l).bind("touchstart",q);$(l).bind("touchmove",o);$(l).bind("touchend",d)}}else{$(l).attr("style","cursor:default");$(l).unbind("mousedown",n);$(l).unbind("mousemove",i);$(l).unbind("mouseup",s);$(document).unbind("mouseup",s);a=navigator.userAgent;if(a.indexOf("iPhone")>0||a.indexOf("iPod")>
0){$(l).unbind("touchstart",q);$(l).unbind("touchmove",o);$(l).unbind("touchend",d)}}return f};var x=function(){};f.change=function(a){if(a==null||a===undefined)x=function(){};else if(typeof a=="function")x=a};var u=new y,j=t.strokes;if(jQuery.isArray(j)&&j.length>0)u.add({type:"init",strokes:jQuery.merge([],j)});else j=[];e();f.editing(t.editing)},y=function(){var b=this,c=[],e=-1,p=-1,n=null;b.add=function(i){e+1<c.length&&c.splice(e+1,c.length-(e+1));c.push(i);e=c.length-1;n=null};b.freeze=function(i){p=
i===undefined?e:i};b.undoable=function(){return e>-1&&e>p};b.undo=function(){if(b.undoable()){e--;n=null}};b.redoable=function(){return e<c.length-1};b.redo=function(){if(b.redoable()){e++;n=null}};b.current_strokes=function(){if(n==null){for(var i=[],s=0;s<=e;s++){var q=c[s];switch(q.type){case "init":case "json":case "strokes":case "batch":jQuery.merge(i,q.strokes);break;case "stroke":i.push(q.stroke);break;case "erase":for(var o=0,d=i.length;o<d;o++)equiv(i[o],q.stroke)&&i.splice(o,1);break;case "clear":i=
[];break}}n=i}return n}},g=function(){function b(){if(o!=null&&o.length>1){for(var d=o[0],f="M"+d[0]+","+d[1],t=1,w=o.length;t<w;t++){d=o[t];f+="L"+d[0]+","+d[1]}return f}else return""}var c=this,e="#000000",p=1,n=5,i=null,s=false,q=null,o=[];c.color=function(d){if(d===undefined)return e;e=d;return c};c.width=function(d){if(d===undefined)return n;if(d<g.MIN_WIDTH)d=g.MIN_WIDTH;else if(d>g.MAX_WIDTH)d=g.MAX_WIDTH;n=d;return c};c.opacity=function(d){if(d===undefined)return p;if(d<0)d=0;else if(d>1)d=
1;p=d;return c};c.start=function(d,f){s=true;i=$(f.container()).offset();o.push([d.pageX-i.left,d.pageY-i.top]);q=f.paper().path();q.attr({stroke:e,"stroke-opacity":p,"stroke-width":n,"stroke-linecap":"round","stroke-linejoin":"round"})};c.finish=function(){var d=null;if(q!=null)if(o.length<=1)q.remove();else d=q;s=false;q=null;o=[];return d};c.move=function(d){if(s==true){o.push([d.pageX-i.left,d.pageY-i.top]);q.attr({path:b()})}}};g.MAX_WIDTH=1E3;g.MIN_WIDTH=1})(window.Raphael);
Raphael.fn.display=function(h){for(var r=0,y=h.length;r<y;r++){var g=h[r];this[g.type]().attr(g)}};
function hoozit(h){if(h.constructor===String)return"string";else if(h.constructor===Boolean)return"boolean";else if(h.constructor===Number)return isNaN(h)?"nan":"number";else if(typeof h==="undefined")return"undefined";else if(h===null)return"null";else if(h instanceof Array)return"array";else if(h instanceof Date)return"date";else if(h instanceof RegExp)return"regexp";else if(typeof h==="object")return"object";else if(h instanceof Function)return"function"}
function bindCallbacks(h,r,y){if(h=hoozit(h))return hoozit(r[h])==="function"?r[h].apply(r,y):r[h]}
var equiv=function(){var h,r=[],y=function(){function g(b,c){return b instanceof c.constructor||c instanceof b.constructor?c==b:c===b}return{string:g,"boolean":g,number:g,"null":g,undefined:g,nan:function(b){return isNaN(b)},date:function(b,c){return hoozit(b)==="date"&&c.valueOf()===b.valueOf()},regexp:function(b,c){return hoozit(b)==="regexp"&&c.source===b.source&&c.global===b.global&&c.ignoreCase===b.ignoreCase&&c.multiline===b.multiline},"function":function(){var b=r[r.length-1];return b!==Object&&
typeof b!=="undefined"},array:function(b,c){var e,p;if(hoozit(b)!=="array")return false;p=c.length;if(p!==b.length)return false;for(e=0;e<p;e++)if(!h(c[e],b[e]))return false;return true},object:function(b,c){var e,p=true,n=[],i=[];if(c.constructor!==b.constructor)return false;r.push(c.constructor);for(e in c){n.push(e);h(c[e],b[e])||(p=false)}r.pop();for(e in b)i.push(e);return p&&h(n.sort(),i.sort())}}}();return h=function(){var g=Array.prototype.slice.apply(arguments);if(g.length<2)return true;
return(g[0]===g[1]?true:g[0]===null||g[1]===null||typeof g[0]==="undefined"||typeof g[1]==="undefined"||hoozit(g[0])!==hoozit(g[1])?false:bindCallbacks(g[0],y,[g[1],g[0]]))&&arguments.callee.apply(this,g.splice(1,g.length-1))}}();
